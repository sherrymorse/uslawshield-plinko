<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>U.S. LawShield PLINKO – Cloud Version (jsonbin.io)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family:'Oswald',sans-serif;
    background:linear-gradient(135deg,#1e3c72,#2a5298,#7e8ba3);
    min-height:100vh;
    color:white;
    overflow-x:hidden;
  }
  body::before{
    content:''; position:fixed; inset:0;
    background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff10" d="M0,96L48,112C96,128,192,160,288,165.3C384,171,480,149,576,154.7C672,160,768,192,864,197.3C960,203,1056,181,1152,165.3C1248,149,1344,139,1392,133.3L1440,128L1440,320L0,320Z"></path></svg>') repeat-x;
    animation:wave 20s linear infinite;
    pointer-events:none;
  }
  @keyframes wave{0%{background-position-x:0}100%{background-position-x:1440px}}
  .header{text-align:center;padding:20px;background:rgba(0,0,0,0.6);}
  .main-title{font-family:'Bebas Neue',sans-serif;font-size:4.5em;letter-spacing:5px;
    text-shadow:0 0 30px gold,3px 3px 0 #000;animation:glow 2s infinite alternate;}
  @keyframes glow{to{text-shadow:0 0 60px gold,5px 5px 0 #000}}
  .game-container{display:flex;gap:30px;justify-content:center;padding:20px;max-width:1400px;margin:auto;flex-wrap:wrap;}
  .plinko-wrapper{background:#0f172a;border-radius:20px;padding:20px;box-shadow:0 20px 50px rgba(0,0,0,0.7);}
  .plinko-wrapper::before{content:"PLINKO";position:absolute;top:-15px;left:50%;transform:translateX(-50%);
    font-family:'Bebas Neue';font-size:2.5em;color:gold;letter-spacing:8px;}
  canvas{background:#0f172a;border-radius:15px;box-shadow:inset 0 0 30px #000,0 0 30px gold;}
  .controls-panel{background:white;color:#333;padding:25px;border-radius:20px;width:340px;
    box-shadow:0 15px 40px rgba(0,0,0,0.4);}
  .drop-zone{background:linear-gradient(90deg,#22c55e,#84cc16);padding:15px;border-radius:12px;text-align:center;
    font-weight:bold;animation:pulse 2s infinite;}
  @keyframes pulse{50%{transform:scale(1.03)}}
  .disc-item{background:#dc2626;color:white;padding:14px;border-radius:50px;margin:12px 0;cursor:grab;
    text-align:center;font-weight:bold;transition:all .3s;box-shadow:0 5px 15px rgba(220,38,38,.5);}
  .disc-item:hover{transform:scale(1.08);box-shadow:0 10px 25px rgba(220,38,38,.7);}
  .disc-item:active{cursor:grabbing;transform:scale(.95);}
  .btn{background:#7c3aed;color:white;padding:14px 28px;border:none;border-radius:50px;
    font-weight:bold;cursor:pointer;margin-top:15px;width:100%;transition:all .3s;}
  .btn:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(124,58,237,.6);}
  .stats{background:#f1f5f9;padding:15px;border-radius:12px;margin-top:20px;}
  .stat{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #ddd;}
  .bigwin{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
    font-size:6em;color:gold;text-shadow:0 0 40px gold;z-index:9999;pointer-events:none;
    animation:winpop 1.5s forwards;}
  @keyframes winpop{0%{transform:translate(-50%,-50%) scale(0) rotate(-180deg)}50%{transform:translate(-50%,-50%) scale(1.3)}100%{transform:translate(-50%,-50%) scale(1)}}
  .particle{position:fixed;pointer-events:none;background:gold;border-radius:50%;width:8px;height:8px;
    box-shadow:0 0 10px gold;z-index:998;}
  .status{position:fixed;top:10px;right:10px;background:rgba(0,0,0,.7);padding:8px 16px;border-radius:20px;font-size:13px;}
</style>
</head>
<body>

<div class="status" id="status">Connecting to cloud…</div>

<div class="header">
  <h1 class="main-title">U.S. LAWSHIELD PLINKO</h1>
  <p style="font-size:1.4em;letter-spacing:3px;">LEGAL DEFENSE FOR SELF DEFENSE®</p>
</div>

<div class="game-container">
  <div class="plinko-wrapper">
    <canvas id="c" width="700" height="950"></canvas>
  </div>

  <div class="controls-panel">
    <div class="drop-zone">Drag a disc here & release to drop!</div>
    <div id="discs"></div>
    <button class="btn" onclick="earnDisc()">Earn New Disc</button>
    <div class="stats">
      <div class="stat"><span>Total Winnings</span><b id="total">$0</b></div>
      <div class="stat"><span>Discs Played</span><b id="played">0</b></div>
      <div class="stat"><span>Best Drop</span><b id="best">$0</b></div>
    </div>
  </div>
</div>

<script>
// ==================== JSONBIN.IO CLOUD DATABASE ====================
const MASTER_KEY = "$2a$10$NckuWO.y9g8.amyZZWkc8.lKIMS.AVSCyN1qT9/0d5EtRjuV9lmS2";
const BIN_URL = "https://api.jsonbin.io/v3/b";
let BIN_ID = localStorage.getItem("plinko_bin_id");
let cloud = {
  employees: {},      // employeeId → {name, total, best, played}
  activities: [],     // {employeeId, activity, memberId, timestamp}
  discs: []           // {employeeId, activity, memberId, used:false}
};

async function loadCloud() {
  try {
    if (!BIN_ID) throw "no bin";
    const r = await fetch(`${BIN_URL}/${BIN_ID}/latest`, {headers:{'X-Master-Key':MASTER_KEY}});
    if (r.ok) { cloud = await r.json(); document.getElementById("status").textContent="Cloud Connected"; }
  } catch(e) {
    // first time → create new bin
    const r = await fetch(BIN_URL, {
      method:"POST",
      headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY,'X-Bin-Name':'USLawShield-Plinko'},
      body:JSON.stringify(cloud)
    });
    const data = await r.json();
    BIN_ID = data.metadata.id;
    localStorage.setItem("plinko_bin_id", BIN_ID);
    document.getElementById("status").textContent="Cloud Created & Connected";
  }
}
async function saveCloud() {
  if (!BIN_ID) return;
  await fetch(`${BIN_URL}/${BIN_ID}`, {
    method:"PUT",
    headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY},
    body:JSON.stringify(cloud)
  });
}
// ==================================================================

let employeeId = localStorage.getItem("employeeId");
let employeeName = localStorage.getItem("employeeName") || prompt("Welcome! Enter your name to start:") || "Player";
if (!employeeId) { employeeId = "emp_"+Date.now(); localStorage.setItem("employeeId",employeeId); }
localStorage.setItem("employeeName",employeeName);

if (!cloud.employees[employeeId]) cloud.employees[employeeId] = {name:employeeName,total:0,best:0,played:0};
let emp = cloud.employees[employeeId];

// ==================== PLINKO PHYSICS (Price-is-Right accurate) ====================
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const ROWS = 16, PEG_R = 6, DISC_R = 22, DROP_H = 110;
const SLOTS = 9;
const VALUES = [100,500,1000,0,10000,0,1000,500,100];
const pegs = [], particles = [];
let disc = null, trail = [];

function initPegs() {
  const startY = DROP_H + 60;
  const rowH = (H - 180 - startY) / ROWS;
  const colW = W / 10;
  for (let r=0; r<ROWS; r++) {
    const cols = r%2===0 ? 9 : 10;
    const offset = r%2===0 ? colW : colW/2;
    for (let c=0; c<cols; c++) {
      pegs.push({x: offset + c*colW, y: startY + r*rowH});
    }
  }
}
initPegs();

function draw() {
  ctx.fillStyle = "#0f172a"; ctx.fillRect(0,0,W,H);

  // drop zone
  const grad = ctx.createLinearGradient(0,0,0,DROP_H);
  grad.addColorStop(0,"#22c55e"); grad.addColorStop(1,"#84cc16");
  ctx.fillStyle=grad; ctx.fillRect(0,0,W,DROP_H);
  ctx.fillStyle="white"; ctx.font="bold 24px Oswald"; ctx.textAlign="center";
  ctx.fillText("DROP ZONE", W/2, DROP_H/2+8);

  // pegs
  pegs.forEach(p=>{
    const g = ctx.createRadialGradient(p.x-3,p.y-3,0,p.x,p.y,PEG_R);
    g.addColorStop(0,"gold"); g.addColorStop(1,"#f59e0b");
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,PEG_R,0,Math.PI*2); ctx.fill();
  });

  // slots
  const slotH = 90, slotW = W/SLOTS;
  VALUES.forEach((v,i)=>{
    ctx.fillStyle = i===4?"#f59e0b":(v===0?"#ef4444":"#22c55e");
    ctx.fillRect(i*slotW, H-slotH, slotW, slotH);
    ctx.strokeStyle="#000"; ctx.lineWidth=3; ctx.strokeRect(i*slotW, H-slotH, slotW, slotH);
    ctx.fillStyle="white"; ctx.font="bold 30px Oswald";
    ctx.fillText(v===0?"0":("$"+v), i*slotW + slotW/2, H-slotH/2 +10);
  });

  // trail
  trail.forEach((t,i)=>{ ctx.globalAlpha = i/trail.length*.4;
    ctx.fillStyle="#dc2626"; ctx.beginPath(); ctx.arc(t.x,t.y,DISC_R*.7,0,Math.PI*2); ctx.fill();
  }); ctx.globalAlpha=1;

  // current disc
  if (disc) {
    ctx.save(); ctx.translate(disc.x,disc.y); ctx.rotate(disc.spin);
    const g = ctx.createRadialGradient(-6,-6,0,0,0,DISC_R);
    g.addColorStop(0,"#ef4444"); g.addColorStop(0.7,"#991b1b"); g.addColorStop(1,"#450a0a");
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,DISC_R,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="rgba(255,255,255,.4)"; ctx.beginPath(); ctx.arc(-6,-6,DISC_R*.4,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="white"; ctx.font="bold 12px Oswald"; ctx.textAlign="center"; ctx.fillText("USL",0,4);
    ctx.restore();
  }

  // particles
  particles.forEach((p,i)=>{
    p.y -= p.vy; p.life--;
    ctx.globalAlpha = p.life/20;
    ctx.fillStyle = p.color;
    ctx.beginPath(); ctx.arc(p.x + Math.sin(p.life)*10, p.y, 6,0,Math.PI*2); ctx.fill();
    if (p.life<=0) particles.splice(i,1);
  }); ctx.globalAlpha=1;
}

let dragging = false;
canvas.addEventListener("mousedown", e=>{
  if (emp.discsUsed >= emp.discsEarned) return;
  const r = canvas.getBoundingClientRect();
  const y = e.clientY - r.top;
  if (y < DROP_H) dragging = true;
});
canvas.addEventListener("mousemove", e=>{
  if (!dragging) return;
  const r = canvas.getBoundingClientRect();
  disc = {x: e.clientX-r.left, y: Math.min(e.clientY-r.top, DROP_H-10), vx:0, vy:0, spin:0, spinV:0};
  draw();
});
canvas.addEventListener("mouseup", e=>{
  if (!dragging) return; dragging=false;
  const r = canvas.getBoundingClientRect();
  const x = e.clientX-r.left, y = e.clientY-r.top;
  if (y <= DROP_H && emp.discsUsed < emp.discsEarned) {
    emp.discsUsed = (emp.discsUsed||0) + 1;
    disc = {x, y, vx:(Math.random()-0.5)*30, vy:0, spin:0, spinV:(Math.random()-0.5)*0.3};
    trail=[]; updateDiscsUI(); saveCloud();
    requestAnimationFrame(loop);
  }
  disc = null; draw();
});

function loop(){
  if (!disc) return;
  disc.vy += 480;                     // scaled gravity
  disc.vx *= 0.995; disc.vy *= 0.995; // air
  disc.x += disc.vx*0.016;
  disc.y += disc.vy*0.016;
  disc.spin += disc.spinV;
  disc.spinV *= 0.99;

  trail.push({x:disc.x,y:disc.y}); if(trail.length>25) trail.shift();

  // peg collisions
  pegs.forEach(p=>{
    const dx = disc.x-p.x, dy=disc.y-p.y, dist=Math.hypot(dx,dy);
    if (dist < DISC_R+PEG_R) {
      const nx=dx/dist, ny=dy/dist;
      const dot = disc.vx*nx + disc.vy*ny;
      disc.vx -= 2*dot*nx*0.78;
      disc.vy -= 2*dot*ny*0.78;
      disc.spinV += (Math.random()-0.5)*0.4;
      disc.vx += (Math.random()-0.5)*20;
      disc.vy += (Math.random()-0.5)*10;
      // push out
      const overlap = DISC_R+PEG_R - dist;
      disc.x += nx*overlap; disc.y += ny*overlap;
    }
  });

  // walls
  if (disc.x < DISC_R+20) { disc.x = DISC_R+20; disc.vx = Math.abs(disc.vx)*0.78; }
  if (disc.x > W-DISC_R-20) { disc.x = W-DISC_R-20; disc.vx = -Math.abs(disc.vx)*0.78; }

  // landing
  if (disc.y > H-100) {
    const slot = Math.floor(disc.x / (W/SLOTS));
    const win = VALUES[Math.min(Math.max(slot,0),8)];
    emp.total += win; emp.best = Math.max(emp.best,win); emp.played++;
    document.getElementById("total").textContent = "$"+emp.total;
    document.getElementById("best").textContent = "$"+emp.best;
    document.getElementById("played").textContent = emp.played;

    if (win >= 1000) {
      const el = document.createElement("div"); el.className="bigwin"; el.textContent="$"+win+"!";
      document.body.appendChild(el); setTimeout(()=>el.remove(),2000);
      for(let i=0;i<50;i++){
        particles.push({x:disc.x,y:H-50,vy:Math.random()*8+4,life:40,color:"#fbbf24"});
      }
    }
    saveCloud();
    disc=null; trail=[];
  }

  draw();
  if (disc) requestAnimationFrame(loop);
}

// ==================== DISC UI & EARNING ====================
function updateDiscsUI(){
  const list = document.getElementById("discs");
  list.innerHTML="";
  const available = (emp.discsEarned||0) - (emp.discsUsed||0);
  for(let i=0;i<available;i++){
    const d = document.createElement("div"); d.className="disc-item";
    d.textContent = `Disc ${i+1} Ready`;
    list.appendChild(d);
  }
  if(available===0) list.innerHTML="<p style='text-align:center;color:#666'>No discs — earn more!</p>";
}

function earnDisc(){
  const activities = ["Single PR","Dual PR","Monthly LOC","Annual LOC","Save","Winback","Add E-Shield","Conversion"];
  const act = prompt("Activity completed:\n\n" + activities.map((a,i)=>`${i+1}. ${a}`).join("\n") + "\n\nEnter number or name:");
  const member = prompt("Member ID (e.g. TX123456):")?.toUpperCase();
  if (act && member && /^[A-Z]{2,3}\d+$/.test(member)) {
    emp.discsEarned = (emp.discsEarned||0) + 1;
    cloud.activities.push({employeeId, name:employeeName, activity:act, memberId:member, time:Date.now()});
    updateDiscsUI(); saveCloud();
    alert("Disc earned! You now have " + ((emp.discsEarned||0)-(emp.discsUsed||0)) + " discs");
  } else alert("Invalid input — try again");
}

// ==================== INIT ====================
loadCloud().then(()=>{
  emp.discsEarned = emp.discsEarned||0;
  emp.discsUsed = emp.discsUsed||0;
  document.getElementById("total").textContent = "$"+emp.total;
  document.getElementById("best").textContent = "$"+emp.best;
  document.getElementById("played").textContent = emp.played;
  updateDiscsUI();
  draw();
});
</script>
</body>
</html>
