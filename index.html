<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>U.S. LawShield PLINKO ‚Äì Premium Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  :root {
    --seahawks-navy: #002244;
    --seahawks-green: #69BE28;
    --seahawks-blue: #245998;
    --seahawks-gray: #A5ACAF;
    --accent-gold: #FFD700;
    --accent-orange: #FF8C00;
    --accent-red: #FF6B6B;
    --accent-purple: #9B59B6;
    --accent-teal: #1ABC9C;
  }
  
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, var(--seahawks-navy) 0%, var(--seahawks-blue) 50%, var(--seahawks-navy) 100%);
    min-height: 100vh;
    color: white;
    overflow-x: hidden;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 25px;
  }

  .header {
    grid-column: 1 / -1;
    text-align: center;
    padding: 25px;
    background: linear-gradient(180deg, rgba(0, 34, 68, 0.95) 0%, rgba(41, 128, 185, 0.8) 100%);
    border-bottom: 6px solid var(--accent-gold);
    border-radius: 20px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }

  .header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 20% 80%, rgba(105, 190, 40, 0.2) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.2) 0%, transparent 50%);
    pointer-events: none;
  }

  .title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 5em;
    letter-spacing: 8px;
    text-shadow: 0 0 40px var(--accent-gold), 4px 4px 0 #000;
    color: white;
    margin-bottom: 10px;
    position: relative;
  }

  .subtitle {
    font-size: 1.6em;
    letter-spacing: 4px;
    color: var(--accent-gold);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    font-weight: 800;
    font-family: 'Oswald', sans-serif;
  }

  .game-section {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.9) 0%, rgba(36, 89, 152, 0.9) 100%);
    border-radius: 25px;
    padding: 25px;
    border: 4px solid var(--accent-gold);
    box-shadow: 0 15px 50px rgba(0,0,0,0.6);
    position: relative;
  }

  .canvas-wrapper {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 
      0 0 80px rgba(105, 190, 40, 0.6),
      inset 0 0 60px rgba(0, 0, 0, 0.8);
    border: 8px solid var(--seahawks-navy);
    background: linear-gradient(135deg, #001933 0%, #003366 100%);
    margin-bottom: 25px;
  }

  #plinkoCanvas {
    display: block;
    background: linear-gradient(135deg, #001933 0%, #003366 100%);
    width: 100%;
  }

  .drop-zone {
    background: linear-gradient(135deg, var(--seahawks-green) 0%, #4A8A1F 100%);
    padding: 20px 40px;
    border-radius: 20px;
    font-size: 24px;
    font-weight: 800;
    box-shadow: 0 12px 35px rgba(105, 190, 40, 0.8);
    border: 4px solid var(--accent-gold);
    color: var(--seahawks-navy);
    text-align: center;
    position: relative;
    animation: pulse-glow 2s infinite;
    font-family: 'Oswald', sans-serif;
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  @keyframes pulse-glow {
    0%, 100% { 
      box-shadow: 0 12px 35px rgba(105, 190, 40, 0.8);
      transform: scale(1);
    }
    50% { 
      box-shadow: 0 18px 45px rgba(105, 190, 40, 1);
      transform: scale(1.02);
    }
  }

  .prompt {
    position: absolute;
    top: -35px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--seahawks-navy);
    padding: 10px 20px;
    border-radius: 15px;
    font-size: 14px;
    white-space: nowrap;
    font-weight: 700;
    border: 3px solid var(--accent-gold);
    color: var(--accent-gold);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .control-section {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.9) 0%, rgba(36, 89, 152, 0.9) 100%);
    border-radius: 25px;
    padding: 25px;
    border: 4px solid var(--accent-gold);
    box-shadow: 0 15px 50px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .setup-panel {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.95) 0%, rgba(41, 128, 185, 0.9) 100%);
    padding: 25px;
    border-radius: 20px;
    border: 3px solid var(--accent-gold);
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }

  .panel-title {
    color: var(--accent-gold);
    font-size: 28px;
    margin-bottom: 20px;
    text-align: center;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 3px;
    text-transform: uppercase;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    display: block;
    color: var(--accent-gold);
    margin-bottom: 10px;
    font-weight: 700;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  input[type="text"], select {
    width: 100%;
    padding: 15px;
    border: 3px solid var(--accent-gold);
    border-radius: 12px;
    background: rgba(0, 25, 51, 0.8);
    color: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s;
  }

  input[type="text"]:focus, select:focus {
    outline: none;
    border-color: var(--seahawks-green);
    box-shadow: 0 0 20px rgba(105, 190, 40, 0.6);
    background: rgba(0, 25, 51, 0.9);
  }

  .board-selection {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
  }

  .board-option {
    flex: 1;
    text-align: center;
    padding: 15px;
    background: rgba(0, 25, 51, 0.8);
    border: 3px solid var(--accent-gold);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    color: var(--accent-gold);
    font-weight: 700;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .board-option:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
  }

  .board-option.selected {
    background: var(--accent-gold);
    color: var(--seahawks-navy);
    border-color: var(--seahawks-navy);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
  }

  .btn {
    background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-orange) 100%);
    color: var(--seahawks-navy);
    padding: 18px 30px;
    border: none;
    border-radius: 50px;
    font-size: 18px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 2px;
    border: 3px solid var(--seahawks-navy);
    font-family: 'Oswald', sans-serif;
    width: 100%;
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
  }

  .btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(255, 215, 0, 0.8);
    background: linear-gradient(135deg, #FFE55C 0%, #FFA500 100%);
  }

  .btn-cta {
    background: linear-gradient(135deg, var(--seahawks-green) 0%, #4A8A1F 100%);
    font-size: 20px;
    padding: 20px;
    border: 3px solid var(--accent-gold);
    box-shadow: 0 10px 30px rgba(105, 190, 40, 0.6);
  }

  .btn-cta:hover {
    box-shadow: 0 15px 40px rgba(105, 190, 40, 0.9);
    background: linear-gradient(135deg, #7ACF32 0%, #5A9A2F 100%);
  }

  .game-info {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.95) 0%, rgba(41, 128, 185, 0.9) 100%);
    padding: 25px;
    border-radius: 20px;
    border: 3px solid var(--accent-gold);
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }

  .info-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    padding: 12px 0;
    border-bottom: 2px solid rgba(255, 215, 0, 0.3);
  }

  .info-label {
    color: var(--accent-gold);
    font-weight: 700;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .info-value {
    color: white;
    font-weight: 800;
    font-size: 18px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  }

  .prize-legend {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.95) 0%, rgba(41, 128, 185, 0.9) 100%);
    padding: 25px;
    border-radius: 20px;
    border: 3px solid var(--accent-gold);
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    max-height: 350px;
    overflow-y: auto;
  }

  .legend-title {
    color: var(--accent-gold);
    font-size: 24px;
    margin-bottom: 20px;
    text-align: center;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 3px;
    text-transform: uppercase;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }

  .legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    padding: 12px;
    background: rgba(0, 25, 51, 0.7);
    border-radius: 12px;
    border: 2px solid rgba(255, 215, 0, 0.3);
    transition: all 0.3s;
  }

  .legend-item:hover {
    transform: translateX(5px);
    border-color: var(--accent-gold);
    background: rgba(0, 25, 51, 0.9);
  }

  .legend-symbol {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    margin-right: 15px;
    flex-shrink: 0;
    border: 3px solid white;
    font-size: 18px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  .legend-text {
    color: white;
    font-size: 14px;
    font-weight: 700;
    line-height: 1.4;
  }

  .current-board {
    position: absolute;
    top: 20px;
    left: 20px;
    background: linear-gradient(135deg, var(--seahawks-navy) 0%, var(--seahawks-blue) 100%);
    padding: 12px 25px;
    border-radius: 25px;
    border: 3px solid var(--accent-gold);
    color: var(--accent-gold);
    font-weight: 800;
    z-index: 10;
    font-size: 18px;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    font-family: 'Oswald', sans-serif;
  }

  .puck-counter {
    position: absolute;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, var(--seahawks-navy) 0%, var(--seahawks-blue) 100%);
    padding: 12px 25px;
    border-radius: 25px;
    border: 3px solid var(--accent-gold);
    color: var(--accent-gold);
    font-weight: 800;
    z-index: 10;
    font-size: 18px;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    font-family: 'Oswald', sans-serif;
  }

  .connection-status {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--seahawks-navy) 0%, var(--seahawks-blue) 100%);
    padding: 10px 20px;
    border-radius: 25px;
    border: 3px solid var(--accent-gold);
    color: var(--accent-gold);
    font-weight: 700;
    font-size: 14px;
    z-index: 10;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
  }

  .bigwin {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    font-size: 8em;
    color: var(--accent-gold);
    text-shadow: 0 0 50px var(--accent-gold), 0 0 100px var(--accent-orange);
    z-index: 9999;
    pointer-events: none;
    animation: win 2s forwards;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 8px;
    text-align: center;
  }

  @keyframes win {
    0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }

  .admin-panel {
    grid-column: 1 / -1;
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.95) 0%, rgba(36, 89, 152, 0.9) 100%);
    border-radius: 25px;
    padding: 30px;
    border: 4px solid var(--accent-gold);
    margin-top: 25px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.6);
  }

  .admin-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
  }

  .admin-btn {
    background: linear-gradient(135deg, var(--accent-red) 0%, #ee5a52 100%);
    color: white;
    padding: 15px 25px;
    border: none;
    border-radius: 12px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-family: 'Oswald', sans-serif;
    font-size: 16px;
    box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .admin-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
  }

  .prize-display {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.95) 0%, rgba(41, 128, 185, 0.9) 100%);
    padding: 25px;
    border-radius: 20px;
    border: 3px solid var(--accent-gold);
    margin-top: 25px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }

  .prize-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 15px;
  }

  .prize-item {
    background: rgba(0, 25, 51, 0.7);
    padding: 20px;
    border-radius: 15px;
    border: 3px solid var(--accent-gold);
    text-align: center;
    transition: all 0.3s;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .prize-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    border-color: var(--seahawks-green);
  }

  .prize-symbol {
    font-size: 2.5em;
    margin-bottom: 12px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }

  .prize-name {
    color: var(--accent-gold);
    font-weight: 800;
    font-size: 16px;
    line-height: 1.4;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .board-b {
    background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
    border-color: var(--accent-gold);
  }

  .board-b .legend-symbol {
    border-color: var(--accent-gold);
  }

  .mode-selector {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    grid-column: 1 / -1;
  }

  .mode-btn {
    flex: 1;
    padding: 18px;
    background: rgba(0, 25, 51, 0.8);
    border: 3px solid var(--accent-gold);
    border-radius: 15px;
    color: var(--accent-gold);
    font-weight: 800;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-family: 'Oswald', sans-serif;
    font-size: 18px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .mode-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
  }

  .mode-btn.active {
    background: var(--accent-gold);
    color: var(--seahawks-navy);
    border-color: var(--seahawks-navy);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
  }

  .notification-panel {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 350px;
    background: linear-gradient(135deg, var(--seahawks-navy) 0%, var(--seahawks-blue) 100%);
    border: 3px solid var(--accent-gold);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    z-index: 10000;
    transform: translateX(400px);
    transition: transform 0.5s ease;
  }

  .notification-panel.show {
    transform: translateX(0);
  }

  .notification-title {
    color: var(--accent-gold);
    font-size: 20px;
    margin-bottom: 15px;
    text-align: center;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .notification-list {
    max-height: 300px;
    overflow-y: auto;
  }

  .notification-item {
    background: rgba(0, 25, 51, 0.7);
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 10px;
    border-left: 4px solid var(--accent-gold);
    font-size: 14px;
    line-height: 1.4;
  }

  .notification-time {
    color: var(--accent-gold);
    font-size: 12px;
    font-weight: 700;
    margin-top: 5px;
  }

  .player-status {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.95) 0%, rgba(41, 128, 185, 0.9) 100%);
    padding: 20px;
    border-radius: 20px;
    border: 3px solid var(--accent-gold);
    margin-top: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }

  .status-title {
    color: var(--accent-gold);
    font-size: 20px;
    margin-bottom: 15px;
    text-align: center;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .status-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 215, 0, 0.2);
  }

  .status-label {
    color: var(--accent-gold);
    font-weight: 700;
    font-size: 14px;
  }

  .status-value {
    color: white;
    font-weight: 800;
    font-size: 14px;
  }

  .locked-field {
    background: rgba(0, 25, 51, 0.5) !important;
    color: var(--accent-gold) !important;
    border-color: var(--accent-gold) !important;
    cursor: not-allowed !important;
  }

  .locked-field::placeholder {
    color: rgba(255, 215, 0, 0.6) !important;
  }
</style>
</head>
<body>
<div class="notification-panel" id="notificationPanel">
  <h3 class="notification-title">üîî ADMIN NOTIFICATIONS</h3>
  <div class="notification-list" id="notificationList">
    <div class="notification-item">
      System initialized and ready
      <div class="notification-time">Just now</div>
    </div>
  </div>
</div>

<div class="container">
  <div class="header">
    <h1 class="title">U.S. LAWSHIELD PLINKO</h1>
    <p class="subtitle">LEGAL DEFENSE FOR SELF DEFENSE¬Æ</p>
  </div>

  <div class="mode-selector">
    <div class="mode-btn active" data-mode="player">üéÆ PLAYER VIEW</div>
    <div class="mode-btn" data-mode="admin">‚öôÔ∏è ADMIN VIEW</div>
  </div>

  <div class="game-section">
    <div class="canvas-wrapper">
      <div class="current-board" id="currentBoard">BOARD A</div>
      <div class="puck-counter">PUCKS: <span id="puckCounter">0</span></div>
      <div class="connection-status" id="connectionStatus">üî¥ OFFLINE</div>
      <canvas id="plinkoCanvas" width="800" height="1000"></canvas>
    </div>
    <div class="drop-zone">
      DROP ZONE
      <div class="prompt">Hover puck ‚Üí Click & hold ‚Üí Position ‚Üí Release to drop!</div>
    </div>
  </div>

  <div class="control-section">
    <div class="setup-panel" id="playerSetup">
      <h3 class="panel-title">PLAYER SETUP</h3>
      <div class="form-group">
        <label for="playerName">Player Name:</label>
        <input type="text" id="playerName" placeholder="Enter player name">
      </div>
      <div class="form-group">
        <label>Select Board(s):</label>
        <div class="board-selection">
          <div class="board-option" data-board="A">Board A</div>
          <div class="board-option" data-board="B">Board B</div>
          <div class="board-option" data-board="BOTH">Both</div>
        </div>
      </div>
      <div class="form-group">
        <label for="puckCount">Number of Pucks:</label>
        <select id="puckCount">
          <option value="1">1 Puck</option>
          <option value="2">2 Pucks</option>
          <option value="3">3 Pucks</option>
          <option value="5">5 Pucks</option>
        </select>
      </div>
      <button class="btn btn-cta" id="startGame">START GAME</button>
    </div>

    <div class="setup-panel" id="adminSetup" style="display: none;">
      <h3 class="panel-title">ADMIN SETUP</h3>
      <div class="form-group">
        <label for="gameIdInput">Game ID to Monitor:</label>
        <input type="text" id="gameIdInput" placeholder="Enter Game ID">
      </div>
      <button class="btn btn-cta" id="connectToGame">CONNECT TO GAME</button>
    </div>

    <div class="game-info">
      <h3 class="panel-title">GAME INFO</h3>
      <div class="info-item">
        <span class="info-label">Game ID:</span>
        <span class="info-value" id="gameId">-</span>
      </div>
      <div class="info-item">
        <span class="info-label">Player:</span>
        <span class="info-value" id="playerDisplay">-</span>
      </div>
      <div class="info-item">
        <span class="info-label">Pucks Remaining:</span>
        <span class="info-value" id="pucksRemaining">0</span>
      </div>
      <div class="info-item">
        <span class="info-label">Total Won:</span>
        <span class="info-value" id="totalWon">0 prizes</span>
      </div>
    </div>

    <div class="player-status" id="playerStatus" style="display: none;">
      <h3 class="status-title">PLAYER STATUS</h3>
      <div class="status-item">
        <span class="status-label">Current Action:</span>
        <span class="status-value" id="currentAction">Waiting to start</span>
      </div>
      <div class="status-item">
        <span class="status-label">Last Activity:</span>
        <span class="status-value" id="lastActivity">-</span>
      </div>
      <div class="status-item">
        <span class="status-label">Connection:</span>
        <span class="status-value" id="playerConnection">Not connected</span>
      </div>
    </div>

    <div class="prize-legend" id="legendA">
      <h3 class="legend-title">BOARD A PRIZES</h3>
      <!-- Legend items will be populated by JavaScript -->
    </div>

    <div class="prize-legend board-b" id="legendB" style="display: none;">
      <h3 class="legend-title">BOARD B PRIZES</h3>
      <!-- Legend items will be populated by JavaScript -->
    </div>
  </div>

  <div class="admin-panel">
    <h3 class="panel-title">ADMIN CONTROLS</h3>
    <div class="admin-controls">
      <button class="admin-btn" id="resetGame">Reset Game</button>
      <button class="admin-btn" id="addPuck">Add Puck</button>
      <button class="admin-btn" id="manualPrize">Add Manual Prize</button>
      <button class="admin-btn" id="switchBoard">Switch Board</button>
      <button class="admin-btn" id="copyGameLink">Copy Game Link</button>
      <button class="admin-btn" id="showNotifications">Show Notifications</button>
    </div>
    
    <div class="prize-display">
      <h3 class="panel-title">PRIZES WON</h3>
      <div class="prize-list" id="wonPrizes">
        <!-- Won prizes will appear here -->
      </div>
    </div>
  </div>
</div>

<script>
// ==================== JSONBIN.IO CONFIGURATION ====================
const JSONBIN_CONFIG = {
  MASTER_KEY: '$2a$10$NckuWO.y9g8.amyZZWkc8.lKIMS.AVSCyN1qT9/0d5EtRjuV9lmS2',
  ACCESS_KEY: '$2a$10$g6RfQ66H6XQyYy3D848Cfurvs0dXgVt92aV0Rr0UqchZrBZwr7Vpy',
  BASE_URL: 'https://api.jsonbin.io/v3/b',
  HEADERS: {
    'Content-Type': 'application/json',
    'X-Master-Key': '$2a$10$NckuWO.y9g8.amyZZWkc8.lKIMS.AVSCyN1qT9/0d5EtRjuV9lmS2'
  }
};

// ==================== GAME STATE ====================
const gameState = {
  gameId: null,
  playerName: '',
  boardType: 'A',
  pucksTotal: 1,
  pucksUsed: 0,
  pucksRemaining: 0,
  currentBoard: 'A',
  prizesWon: [],
  isActive: false,
  currentPuck: null,
  isAdmin: false,
  connected: false,
  binId: null,
  lastUpdated: 0,
  playerStatus: 'waiting',
  lastActivity: null,
  boards: {
    A: {
      name: "Board A",
      color: '#69BE28',
      prizes: [
        { symbol: 'üéÅ', name: '$25 Gift Card', color: '#667eea' },
        { symbol: '‚è∞', name: '1 Hour Campaign of Your Choice', color: '#f093fb' },
        { symbol: 'üë•', name: 'Shadow an Agent for 1 Hour', color: '#4facfe' },
        { symbol: 'üö™', name: 'Leave 15min Early / Come in 15min Late', color: '#ff6b6b' },
        { symbol: '‚òï', name: 'Extra 15 Minute Break', color: '#f6d365' },
        { symbol: 'üìä', name: 'Replace QA Score with Call of Your Choice', color: '#4facfe' },
        { symbol: 'üíº', name: 'Coffee with Leadership', color: '#f093fb' },
        { symbol: '‚è∞', name: '1 Hour Campaign of Your Choice', color: '#f093fb' },
        { symbol: 'üéÅ', name: '$25 Gift Card', color: '#667eea' }
      ]
    },
    B: {
      name: "Board B",
      color: '#FFD700',
      prizes: [
        { symbol: 'üïë', name: '2 Hours Campaign of Your Choice', color: '#9b59b6' },
        { symbol: 'üí∞', name: '$50 Gift Card', color: '#e74c3c' },
        { symbol: '‚è±Ô∏è', name: 'Leave 30 Minutes Early', color: '#3498db' },
        { symbol: 'üíØ', name: 'Replace Lowest QA Score with 100', color: '#2ecc71' },
        { symbol: 'üïì', name: '4 Hours Campaign of Your Choice', color: '#f1c40f' },
        { symbol: 'üçΩÔ∏è', name: 'Lunch on Leadership', color: '#e67e22' },
        { symbol: 'üé¥', name: 'Wild Card', color: '#1abc9c' },
        { symbol: 'üí∞', name: '$50 Gift Card', color: '#e74c3c' },
        { symbol: 'üïë', name: '2 Hours Campaign of Your Choice', color: '#9b59b6' }
      ]
    }
  }
};

// ==================== NOTIFICATION SYSTEM ====================
const notifications = [];

function addNotification(message) {
  const timestamp = new Date().toLocaleTimeString();
  notifications.unshift({
    message,
    timestamp,
    id: Date.now()
  });
  
  // Keep only last 20 notifications
  if (notifications.length > 20) {
    notifications.pop();
  }
  
  updateNotificationDisplay();
  
  // Show notification panel if admin
  if (gameState.isAdmin) {
    document.getElementById('notificationPanel').classList.add('show');
  }
}

function updateNotificationDisplay() {
  const notificationList = document.getElementById('notificationList');
  notificationList.innerHTML = '';
  
  notifications.forEach(notif => {
    const item = document.createElement('div');
    item.className = 'notification-item';
    item.innerHTML = `
      ${notif.message}
      <div class="notification-time">${notif.timestamp}</div>
    `;
    notificationList.appendChild(item);
  });
}

function updatePlayerStatus(status, activity) {
  gameState.playerStatus = status;
  gameState.lastActivity = activity || new Date().toLocaleTimeString();
  
  document.getElementById('currentAction').textContent = status;
  document.getElementById('lastActivity').textContent = gameState.lastActivity;
  
  if (gameState.isAdmin) {
    addNotification(`Player ${status.toLowerCase()}: ${activity || status}`);
  }
}

// ==================== JSONBIN.IO REAL-TIME SYNC ====================
let syncInterval = null;
let isConnected = false;

async function createGameBin(gameState) {
  try {
    const response = await fetch(JSONBIN_CONFIG.BASE_URL, {
      method: 'POST',
      headers: JSONBIN_CONFIG.HEADERS,
      body: JSON.stringify({
        ...gameState,
        created: Date.now(),
        version: 1
      })
    });
    
    const data = await response.json();
    if (data.metadata && data.metadata.id) {
      return data.metadata.id;
    }
    throw new Error('Failed to create bin');
  } catch (error) {
    console.error('Error creating game bin:', error);
    throw error;
  }
}

async function updateGameBin(binId, gameState) {
  try {
    const response = await fetch(`${JSONBIN_CONFIG.BASE_URL}/${binId}`, {
      method: 'PUT',
      headers: JSONBIN_CONFIG.HEADERS,
      body: JSON.stringify({
        ...gameState,
        lastUpdated: Date.now()
      })
    });
    
    const data = await response.json();
    return data.metadata && data.metadata.id;
  } catch (error) {
    console.error('Error updating game bin:', error);
    return false;
  }
}

async function readGameBin(binId) {
  try {
    const response = await fetch(`${JSONBIN_CONFIG.BASE_URL}/${binId}/latest`, {
      headers: {
        'X-Master-Key': JSONBIN_CONFIG.HEADERS['X-Master-Key']
      }
    });
    
    if (!response.ok) throw new Error('Failed to read bin');
    
    const data = await response.json();
    return data.record;
  } catch (error) {
    console.error('Error reading game bin:', error);
    return null;
  }
}

function startSyncInterval(binId) {
  if (syncInterval) clearInterval(syncInterval);
  
  syncInterval = setInterval(async () => {
    if (!binId) return;
    
    const remoteState = await readGameBin(binId);
    if (remoteState && remoteState.lastUpdated > gameState.lastUpdated) {
      // Don't override if we have local changes that are newer
      if (gameState.lastUpdated && gameState.lastUpdated > remoteState.lastUpdated) {
        return;
      }
      
      // Update from remote state
      Object.keys(remoteState).forEach(key => {
        if (key !== 'currentPuck' || !gameState.currentPuck) {
          gameState[key] = remoteState[key];
        }
      });
      
      updateGameDisplay();
      updateBoardDisplay();
      drawBoard();
      
      // Update connection status
      isConnected = true;
      updateConnectionStatus();
      
      // Update player status for admin
      if (gameState.isAdmin) {
        document.getElementById('playerConnection').textContent = 'Connected';
        document.getElementById('playerStatus').style.display = 'block';
      }
    }
  }, 2000); // Sync every 2 seconds to stay within rate limits
}

function stopSyncInterval() {
  if (syncInterval) {
    clearInterval(syncInterval);
    syncInterval = null;
  }
}

function updateConnectionStatus() {
  const statusElement = document.getElementById('connectionStatus');
  if (isConnected) {
    statusElement.textContent = 'üü¢ SYNCED';
    statusElement.style.borderColor = '#69BE28';
  } else {
    statusElement.textContent = 'üî¥ OFFLINE';
    statusElement.style.borderColor = '#ff6b6b';
  }
}

async function saveGameStateToCloud() {
  if (!gameState.binId) return false;
  
  gameState.lastUpdated = Date.now();
  const success = await updateGameBin(gameState.binId, gameState);
  isConnected = success;
  updateConnectionStatus();
  return success;
}

async function loadGameStateFromCloud(binId) {
  const remoteState = await readGameBin(binId);
  if (remoteState) {
    Object.assign(gameState, remoteState);
    gameState.binId = binId;
    isConnected = true;
    updateConnectionStatus();
    updateGameDisplay();
    updateBoardDisplay();
    drawBoard();
    startSyncInterval(binId);
    
    // Lock player fields if not admin
    if (!gameState.isAdmin) {
      lockPlayerFields();
    }
    
    // Add notification for admin
    if (gameState.isAdmin) {
      addNotification(`Connected to game: ${gameState.gameId}`);
      updatePlayerStatus('Connected', 'Player joined the game');
    } else {
      updatePlayerStatus('Ready to play', 'Game loaded successfully');
    }
    
    return true;
  }
  return false;
}

function lockPlayerFields() {
  document.getElementById('playerName').classList.add('locked-field');
  document.getElementById('playerName').readOnly = true;
  document.getElementById('puckCount').classList.add('locked-field');
  document.getElementById('puckCount').disabled = true;
  
  document.querySelectorAll('.board-option').forEach(option => {
    option.classList.add('locked-field');
    option.style.cursor = 'not-allowed';
    option.onclick = null;
  });
  
  document.getElementById('startGame').style.display = 'none';
}

// ==================== PLINKO PHYSICS ====================
const canvas = document.getElementById('plinkoCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const DROP_ZONE_HEIGHT = 120;
const PUCK_RADIUS = 18;
const PEG_RADIUS = 6;
const NUM_ROWS = 20; // Increased rows for better physics
const NUM_SLOTS = 9;

let pegs = [];
let currentPuck = null;
let dragging = false;
let hoverPuck = { x: W/2, y: DROP_ZONE_HEIGHT/2 };
let animationId = null;
let particles = [];

// Initialize pegs with better spacing
function initPegs() {
  pegs = [];
  const startY = DROP_ZONE_HEIGHT + 60; // Reduced initial gap
  const rowHeight = (H - 160 - startY) / NUM_ROWS; // Adjusted for more rows
  const colSpacing = W / 8;
  
  for (let row = 0; row < NUM_ROWS; row++) {
    const numCols = row % 2 === 0 ? 9 : 8;
    const offset = row % 2 === 0 ? 0 : colSpacing / 2;
    
    for (let col = 0; col < numCols; col++) {
      pegs.push({
        x: offset + col * colSpacing,
        y: startY + row * rowHeight
      });
    }
  }
}

// Draw the board with enhanced visuals
function drawBoard() {
  // Clear canvas with gradient
  const bgGradient = ctx.createLinearGradient(0, 0, 0, H);
  bgGradient.addColorStop(0, '#001933');
  bgGradient.addColorStop(1, '#003366');
  ctx.fillStyle = bgGradient;
  ctx.fillRect(0, 0, W, H);
  
  // Draw drop zone with enhanced gradient
  const dropGradient = ctx.createLinearGradient(0, 0, 0, DROP_ZONE_HEIGHT);
  dropGradient.addColorStop(0, '#69BE28');
  dropGradient.addColorStop(0.5, '#4A8A1F');
  dropGradient.addColorStop(1, '#2D5F1D');
  ctx.fillStyle = dropGradient;
  ctx.fillRect(0, 0, W, DROP_ZONE_HEIGHT);
  
  ctx.strokeStyle = '#002244';
  ctx.lineWidth = 6;
  ctx.strokeRect(0, 0, W, DROP_ZONE_HEIGHT);
  
  // Drop zone text with glow
  ctx.shadowColor = '#69BE28';
  ctx.shadowBlur = 10;
  ctx.fillStyle = '#002244';
  ctx.font = 'bold 28px Oswald';
  ctx.textAlign = 'center';
  ctx.fillText('DROP ZONE', W/2, DROP_ZONE_HEIGHT/2 + 10);
  ctx.shadowBlur = 0;
  
  // Draw pegs with glow effect
  pegs.forEach(peg => {
    const pegGradient = ctx.createRadialGradient(
      peg.x - 3, peg.y - 3, 0, peg.x, peg.y, PEG_RADIUS
    );
    pegGradient.addColorStop(0, '#FFD700');
    pegGradient.addColorStop(0.7, '#FFA500');
    pegGradient.addColorStop(1, '#CC8400');
    
    ctx.fillStyle = pegGradient;
    ctx.beginPath();
    ctx.arc(peg.x, peg.y, PEG_RADIUS, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.shadowColor = '#FFD700';
    ctx.shadowBlur = 8;
    ctx.fill();
    ctx.shadowBlur = 0;
  });
  
  // Draw slots with enhanced visuals
  const currentBoard = gameState.boards[gameState.currentBoard];
  const slotHeight = 80;
  const slotWidth = W / NUM_SLOTS;
  
  currentBoard.prizes.forEach((prize, index) => {
    // Slot background with gradient
    const slotGradient = ctx.createLinearGradient(
      index * slotWidth, H - slotHeight,
      index * slotWidth, H
    );
    slotGradient.addColorStop(0, prize.color);
    slotGradient.addColorStop(1, darkenColor(prize.color, 30));
    
    ctx.fillStyle = slotGradient;
    ctx.fillRect(index * slotWidth, H - slotHeight, slotWidth, slotHeight);
    
    // Slot border with glow for center slot
    ctx.strokeStyle = index === 4 ? '#FFD700' : currentBoard.color;
    ctx.lineWidth = index === 4 ? 5 : 3;
    ctx.strokeRect(index * slotWidth, H - slotHeight, slotWidth, slotHeight);
    
    // Prize symbol (rotated) with enhanced styling
    ctx.save();
    ctx.translate(index * slotWidth + slotWidth/2, H - slotHeight/2);
    ctx.rotate(-Math.PI/2);
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 22px Montserrat';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    if (index === 4) {
      ctx.shadowColor = '#FFD700';
      ctx.shadowBlur = 10;
    }
    
    ctx.fillText(prize.symbol, 0, 0);
    ctx.shadowBlur = 0;
    
    ctx.restore();
  });
  
  // Draw hover puck (if available and not dragging)
  if (gameState.pucksRemaining > 0 && !currentPuck && !dragging && !gameState.isAdmin) {
    drawPuck(hoverPuck.x, hoverPuck.y);
  }
  
  // Draw current puck
  if (currentPuck) {
    drawPuck(currentPuck.x, currentPuck.y, currentPuck.rotation);
  }
  
  // Draw particles
  particles.forEach((particle, index) => {
    particle.life--;
    if (particle.life <= 0) {
      particles.splice(index, 1);
      return;
    }
    
    ctx.globalAlpha = particle.life / 60;
    ctx.fillStyle = particle.color;
    ctx.beginPath();
    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
    ctx.fill();
  });
  ctx.globalAlpha = 1;
}

function darkenColor(color, percent) {
  const num = parseInt(color.replace("#", ""), 16);
  const amt = Math.round(2.55 * percent);
  const R = (num >> 16) - amt;
  const G = (num >> 8 & 0x00FF) - amt;
  const B = (num & 0x0000FF) - amt;
  return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
}

function drawPuck(x, y, rotation = 0) {
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(rotation);
  
  const puckGradient = ctx.createRadialGradient(-6, -6, 0, 0, 0, PUCK_RADIUS);
  puckGradient.addColorStop(0, '#FF6B6B');
  puckGradient.addColorStop(0.5, '#EE5A52');
  puckGradient.addColorStop(1, '#CC0000');
  
  ctx.fillStyle = puckGradient;
  ctx.beginPath();
  ctx.arc(0, 0, PUCK_RADIUS, 0, Math.PI * 2);
  ctx.fill();
  
  ctx.strokeStyle = '#002244';
  ctx.lineWidth = 3;
  ctx.stroke();
  
  // Puck details
  ctx.fillStyle = '#002244';
  ctx.beginPath();
  ctx.arc(-6, -6, PUCK_RADIUS * 0.3, 0, Math.PI * 2);
  ctx.fill();
  
  ctx.fillStyle = 'white';
  ctx.font = 'bold 16px Oswald';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('USL', 0, 0);
  
  ctx.restore();
}

// Enhanced physics simulation
function updatePhysics() {
  if (!currentPuck) return;
  
  // Apply gravity with slight variation for realism
  currentPuck.vy += 0.5 + (Math.random() * 0.1);
  
  // Update position
  currentPuck.x += currentPuck.vx;
  currentPuck.y += currentPuck.vy;
  
  // Update rotation based on velocity
  currentPuck.rotation += currentPuck.vx * 0.02;
  
  // Save puck position to cloud for real-time sync
  if (gameState.binId) {
    gameState.currentPuck = currentPuck;
    saveGameStateToCloud();
  }
  
  // Wall collisions with energy loss
  if (currentPuck.x - PUCK_RADIUS < 0) {
    currentPuck.x = PUCK_RADIUS;
    currentPuck.vx = Math.abs(currentPuck.vx) * 0.75;
  } else if (currentPuck.x + PUCK_RADIUS > W) {
    currentPuck.x = W - PUCK_RADIUS;
    currentPuck.vx = -Math.abs(currentPuck.vx) * 0.75;
  }
  
  // Peg collisions with improved physics
  pegs.forEach(peg => {
    const dx = currentPuck.x - peg.x;
    const dy = currentPuck.y - peg.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    const minDistance = PUCK_RADIUS + PEG_RADIUS;
    
    if (distance < minDistance) {
      // Collision response with energy conservation
      const angle = Math.atan2(dy, dx);
      const targetX = peg.x + Math.cos(angle) * minDistance;
      const targetY = peg.y + Math.sin(angle) * minDistance;
      
      currentPuck.x = targetX;
      currentPuck.y = targetY;
      
      // Reflect velocity with realistic energy loss
      const dot = currentPuck.vx * dx + currentPuck.vy * dy;
      currentPuck.vx -= 1.8 * dot * dx / (distance * distance);
      currentPuck.vy -= 1.8 * dot * dy / (distance * distance);
      
      // Add realistic randomness for authentic Plinko behavior
      currentPuck.vx += (Math.random() - 0.5) * 1.5;
      currentPuck.vy += (Math.random() - 0.5) * 1.5;
      
      // Add spin effect
      currentPuck.rotation += currentPuck.vx * 0.05;
    }
  });
  
  // Check if puck reached bottom slots with improved detection
  if (currentPuck.y + PUCK_RADIUS > H - 80) {
    const slotIndex = Math.floor(currentPuck.x / (W / NUM_SLOTS));
    const currentBoard = gameState.boards[gameState.currentBoard];
    const prize = currentBoard.prizes[slotIndex];
    
    // Award prize
    gameState.prizesWon.push({
      board: gameState.currentBoard,
      prize: prize.name,
      symbol: prize.symbol,
      timestamp: Date.now()
    });
    
    // Create enhanced celebration particles
    for (let i = 0; i < 50; i++) {
      particles.push({
        x: currentPuck.x,
        y: H - 40,
        vx: (Math.random() - 0.5) * 12,
        vy: -Math.random() * 18,
        life: 80,
        size: Math.random() * 5 + 3,
        color: prize.color
      });
    }
    
    // Show enhanced win animation for special prizes
    if (slotIndex === 4) { // Middle slot - biggest prize
      const winElement = document.createElement('div');
      winElement.className = 'bigwin';
      winElement.textContent = 'JACKPOT!';
      document.body.appendChild(winElement);
      setTimeout(() => winElement.remove(), 2500);
      
      addNotification(`üéâ Player won JACKPOT: ${prize.name}`);
    } else {
      addNotification(`üéØ Player won: ${prize.name}`);
    }
    
    // Update game state
    gameState.pucksUsed++;
    gameState.pucksRemaining--;
    gameState.currentPuck = null;
    currentPuck = null;
    
    // Update player status
    updatePlayerStatus('Won prize', `Won: ${prize.name}`);
    
    // Check if should switch boards
    if (gameState.boardType === 'BOTH' && gameState.currentBoard === 'A') {
      gameState.currentBoard = 'B';
      updateBoardDisplay();
      initPegs();
      updatePlayerStatus('Board switched', 'Now playing on Board B');
    } else if (gameState.pucksRemaining === 0) {
      // Game over
      gameState.isActive = false;
      updatePlayerStatus('Game completed', 'All pucks used');
      addNotification('üéä Player completed the game!');
    }
    
    // Save final state to cloud
    saveGameStateToCloud();
    updateGameDisplay();
    
    cancelAnimationFrame(animationId);
    drawBoard();
    return;
  }
  
  drawBoard();
  animationId = requestAnimationFrame(updatePhysics);
}

// ==================== GAME CONTROLS ====================
async function startGame() {
  const playerName = document.getElementById('playerName').value.trim();
  const puckCount = parseInt(document.getElementById('puckCount').value);
  const selectedBoard = document.querySelector('.board-option.selected').dataset.board;
  
  if (!playerName) {
    alert('Please enter a player name');
    return;
  }
  
  gameState.playerName = playerName;
  gameState.boardType = selectedBoard;
  gameState.pucksTotal = puckCount;
  gameState.pucksRemaining = puckCount;
  gameState.pucksUsed = 0;
  gameState.currentBoard = selectedBoard === 'B' ? 'B' : 'A';
  gameState.prizesWon = [];
  gameState.isActive = true;
  gameState.isAdmin = false;
  gameState.gameId = 'G' + Date.now().toString().slice(-6);
  gameState.lastUpdated = Date.now();
  
  try {
    // Create cloud storage
    gameState.binId = await createGameBin(gameState);
    isConnected = true;
    updateConnectionStatus();
    
    // Start synchronization
    startSyncInterval(gameState.binId);
    
    // Add notification
    addNotification(`üéÆ New game started: ${playerName}`);
    updatePlayerStatus('Game started', 'Ready to play');
  } catch (error) {
    console.error('Failed to create cloud game:', error);
    alert('Failed to create cloud game. Using local mode only.');
    isConnected = false;
    updateConnectionStatus();
  }
  
  // Update displays
  updateGameDisplay();
  updateBoardDisplay();
  
  // Initialize board with improved physics
  initPegs();
  drawBoard();
  
  // Animate hover puck
  if (!gameState.isAdmin) {
    animateHoverPuck();
  }
}

function updateBoardDisplay() {
  document.getElementById('currentBoard').textContent = `BOARD ${gameState.currentBoard}`;
  
  // Show appropriate legend
  document.getElementById('legendA').style.display = 
    gameState.currentBoard === 'A' || gameState.boardType === 'BOTH' ? 'block' : 'none';
  document.getElementById('legendB').style.display = 
    gameState.currentBoard === 'B' ? 'block' : 'none';
}

function animateHoverPuck() {
  if (!gameState.isActive || currentPuck || gameState.pucksRemaining === 0 || gameState.isAdmin) return;
  
  hoverPuck.x = W/2 + Math.sin(Date.now() * 0.002) * (W/2 - PUCK_RADIUS - 50);
  drawBoard();
  requestAnimationFrame(animateHoverPuck);
}

function updateGameDisplay() {
  document.getElementById('gameId').textContent = gameState.gameId || '-';
  document.getElementById('playerDisplay').textContent = gameState.playerName || '-';
  document.getElementById('puckCounter').textContent = gameState.pucksRemaining;
  document.getElementById('pucksRemaining').textContent = gameState.pucksRemaining;
  document.getElementById('totalWon').textContent = `${gameState.prizesWon.length} prizes`;
  
  // Update won prizes display
  const wonPrizesElement = document.getElementById('wonPrizes');
  wonPrizesElement.innerHTML = '';
  
  gameState.prizesWon.forEach(prize => {
    const prizeElement = document.createElement('div');
    prizeElement.className = 'prize-item';
    prizeElement.innerHTML = `
      <div class="prize-symbol">${prize.symbol}</div>
      <div class="prize-name">${prize.prize}</div>
      <div style="font-size: 12px; color: #A5ACAF; margin-top: 5px;">Board ${prize.board}</div>
    `;
    wonPrizesElement.appendChild(prizeElement);
  });
}

// ==================== EVENT HANDLERS ====================
canvas.addEventListener('mousemove', (e) => {
  if (gameState.isAdmin) return; // Admins can't interact with the board
  
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  
  if (dragging && currentPuck) {
    currentPuck.x = Math.max(PUCK_RADIUS, Math.min(W - PUCK_RADIUS, x));
    currentPuck.y = Math.max(PUCK_RADIUS, Math.min(DROP_ZONE_HEIGHT - PUCK_RADIUS, y));
    drawBoard();
    updatePlayerStatus('Positioning puck', 'Adjusting drop position');
  } else if (gameState.pucksRemaining > 0 && !currentPuck) {
    hoverPuck.x = x;
    hoverPuck.y = y;
  }
});

canvas.addEventListener('mousedown', (e) => {
  if (gameState.isAdmin || !gameState.isActive || currentPuck || gameState.pucksRemaining === 0) return;
  
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  
  // Check if clicking near hover puck
  const distance = Math.sqrt(
    Math.pow(x - hoverPuck.x, 2) + Math.pow(y - hoverPuck.y, 2)
  );
  
  if (distance < PUCK_RADIUS * 1.5) {
    dragging = true;
    currentPuck = {
      x: x,
      y: y,
      vx: 0,
      vy: 0,
      rotation: 0
    };
    drawBoard();
    updatePlayerStatus('Holding puck', 'Ready to drop');
    addNotification('üéØ Player picked up a puck');
  }
});

canvas.addEventListener('mouseup', () => {
  if (gameState.isAdmin) return;
  
  if (dragging && currentPuck) {
    dragging = false;
    
    // Add initial velocity based on drop position for more realistic physics
    const centerX = W / 2;
    currentPuck.vx = (currentPuck.x - centerX) * 0.5;
    currentPuck.vy = 2;
    
    updatePlayerStatus('Puck dropping', 'Watching physics in action');
    addNotification('üé≤ Player dropped the puck!');
    
    animationId = requestAnimationFrame(updatePhysics);
  }
});

// Board selection
document.querySelectorAll('.board-option').forEach(option => {
  option.addEventListener('click', () => {
    if (gameState.isAdmin || gameState.isActive) return;
    
    document.querySelectorAll('.board-option').forEach(opt => opt.classList.remove('selected'));
    option.classList.add('selected');
  });
});

// Mode selection
document.querySelectorAll('.mode-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    const mode = btn.dataset.mode;
    if (mode === 'player') {
      gameState.isAdmin = false;
      document.getElementById('playerSetup').style.display = 'block';
      document.getElementById('adminSetup').style.display = 'none';
      canvas.style.cursor = 'default';
      document.getElementById('playerStatus').style.display = 'none';
    } else {
      gameState.isAdmin = true;
      document.getElementById('playerSetup').style.display = 'none';
      document.getElementById('adminSetup').style.display = 'block';
      canvas.style.cursor = 'default';
      document.getElementById('playerStatus').style.display = 'block';
      addNotification('üëë Admin mode activated');
    }
  });
});

// Start game button
document.getElementById('startGame').addEventListener('click', startGame);

// Connect to game button
document.getElementById('connectToGame').addEventListener('click', async () => {
  const gameId = document.getElementById('gameIdInput').value.trim();
  if (!gameId) {
    alert('Please enter a Game ID');
    return;
  }
  
  gameState.isAdmin = true;
  gameState.gameId = gameId;
  const success = await loadGameStateFromCloud(gameId);
  if (success) {
    updateGameDisplay();
  } else {
    alert('Failed to connect to game. Check the Game ID.');
  }
});

// Admin controls
document.getElementById('resetGame').addEventListener('click', async () => {
  if (confirm('Reset the game? This will clear all progress.')) {
    gameState.isActive = false;
    currentPuck = null;
    gameState.currentPuck = null;
    gameState.prizesWon = [];
    gameState.pucksRemaining = gameState.pucksTotal;
    gameState.pucksUsed = 0;
    gameState.currentBoard = gameState.boardType === 'B' ? 'B' : 'A';
    updateGameDisplay();
    updateBoardDisplay();
    await saveGameStateToCloud();
    drawBoard();
    addNotification('üîÑ Game reset by admin');
    updatePlayerStatus('Game reset', 'Ready for new game');
  }
});

document.getElementById('addPuck').addEventListener('click', async () => {
  gameState.pucksRemaining++;
  gameState.pucksTotal++;
  updateGameDisplay();
  await saveGameStateToCloud();
  addNotification('‚ûï Admin added a puck');
  updatePlayerStatus('Puck added', 'Extra puck granted');
});

document.getElementById('manualPrize').addEventListener('click', async () => {
  const prizeName = prompt('Enter prize name:');
  if (prizeName) {
    gameState.prizesWon.push({
      board: gameState.currentBoard,
      prize: prizeName,
      symbol: 'üéÅ',
      timestamp: Date.now(),
      manual: true
    });
    updateGameDisplay();
    await saveGameStateToCloud();
    addNotification(`üéÅ Manual prize added: ${prizeName}`);
    updatePlayerStatus('Prize awarded', `Manual: ${prizeName}`);
  }
});

document.getElementById('switchBoard').addEventListener('click', async () => {
  gameState.currentBoard = gameState.currentBoard === 'A' ? 'B' : 'A';
  updateBoardDisplay();
  initPegs();
  await saveGameStateToCloud();
  drawBoard();
  addNotification(`üîÑ Board switched to ${gameState.currentBoard}`);
  updatePlayerStatus('Board switched', `Now on Board ${gameState.currentBoard}`);
});

document.getElementById('copyGameLink').addEventListener('click', () => {
  if (!gameState.gameId) {
    alert('No active game to copy link for');
    return;
  }
  
  const gameLink = `${window.location.origin}${window.location.pathname}?game=${gameState.gameId}`;
  navigator.clipboard.writeText(gameLink).then(() => {
    alert('Game link copied to clipboard! Send this to the player.');
    addNotification('üìã Game link copied to clipboard');
  });
});

document.getElementById('showNotifications').addEventListener('click', () => {
  const panel = document.getElementById('notificationPanel');
  panel.classList.toggle('show');
});

// ==================== INITIALIZE LEGENDS ====================
function initializeLegends() {
  // Board A legend
  const legendA = document.getElementById('legendA');
  const uniquePrizesA = [];
  
  gameState.boards.A.prizes.forEach(prize => {
    if (!uniquePrizesA.find(p => p.symbol === prize.symbol)) {
      uniquePrizesA.push(prize);
    }
  });
  
  uniquePrizesA.forEach(prize => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `
      <div class="legend-symbol" style="background: ${prize.color}">${prize.symbol}</div>
      <div class="legend-text">${prize.name}</div>
    `;
    legendA.appendChild(item);
  });
  
  // Board B legend
  const legendB = document.getElementById('legendB');
  const uniquePrizesB = [];
  
  gameState.boards.B.prizes.forEach(prize => {
    if (!uniquePrizesB.find(p => p.symbol === prize.symbol)) {
      uniquePrizesB.push(prize);
    }
  });
  
  uniquePrizesB.forEach(prize => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `
      <div class="legend-symbol" style="background: ${prize.color}">${prize.symbol}</div>
      <div class="legend-text">${prize.name}</div>
    `;
    legendB.appendChild(item);
  });
}

// ==================== URL PARAMETERS ====================
function checkUrlParameters() {
  const urlParams = new URLSearchParams(window.location.search);
  const gameId = urlParams.get('game');
  const isAdmin = urlParams.get('admin') === 'true';
  
  if (gameId) {
    if (isAdmin) {
      document.querySelector('.mode-btn[data-mode="admin"]').click();
      document.getElementById('gameIdInput').value = gameId;
      setTimeout(() => {
        document.getElementById('connectToGame').click();
      }, 500);
    } else {
      // Auto-connect as player
      gameState.gameId = gameId;
      gameState.isAdmin = false;
      loadGameStateFromCloud(gameId);
    }
  }
}

// ==================== INITIALIZATION ====================
initializeLegends();
initPegs();
drawBoard();
checkUrlParameters();
updateConnectionStatus();

// Set default board selection
document.querySelector('.board-option[data-board="A"]').classList.add('selected');

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
  stopSyncInterval();
});

// Show notification panel after a delay for admin
setTimeout(() => {
  if (gameState.isAdmin) {
    document.getElementById('notificationPanel').classList.add('show');
  }
}, 1000);
</script>
</body>
</html>
