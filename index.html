<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>U.S. LawShield PLINKO ‚Äì Premium Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@600;800&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #002244 0%, #003366 50%, #002244 100%);
    min-height: 100vh;
    color: white;
    overflow-x: hidden;
    position: relative;
  }

  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      radial-gradient(circle at 20% 80%, rgba(105, 190, 40, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(105, 190, 40, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, rgba(0, 86, 184, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
  }

  .header {
    text-align: center;
    padding: 25px 20px;
    background: linear-gradient(180deg, rgba(0, 34, 68, 0.95) 0%, rgba(0, 34, 68, 0.8) 100%);
    border-bottom: 4px solid #69BE28;
    position: relative;
    overflow: hidden;
  }

  .title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 4.5em;
    letter-spacing: 6px;
    text-shadow: 0 0 30px #69BE28, 3px 3px 0 #000;
    color: white;
    margin-bottom: 8px;
  }

  .subtitle {
    font-size: 1.4em;
    letter-spacing: 3px;
    color: #69BE28;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    font-weight: 600;
  }

  .cta-banner {
    background: linear-gradient(90deg, #69BE28, #4A8A1F, #69BE28);
    background-size: 200% 100%;
    animation: shimmer 3s infinite;
    padding: 15px;
    text-align: center;
    margin: 15px 0;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(105, 190, 40, 0.4);
  }

  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  .cta-text {
    font-size: 1.3em;
    font-weight: 800;
    color: #002244;
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  .game-container {
    max-width: 1200px;
    margin: 20px auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 25px;
    padding: 0 20px;
  }

  .plinko-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }

  .canvas-wrapper {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 
      0 0 60px rgba(105, 190, 40, 0.5),
      inset 0 0 40px rgba(0, 0, 0, 0.7);
    border: 8px solid #002244;
    background: #001933;
  }

  #c {
    display: block;
    background: #001933;
  }

  .drop-zone {
    background: linear-gradient(135deg, #69BE28 0%, #4A8A1F 100%);
    padding: 15px 30px;
    border-radius: 15px;
    font-size: 22px;
    font-weight: 800;
    box-shadow: 0 10px 30px rgba(105, 190, 40, 0.6);
    border: 3px solid #002244;
    color: #002244;
    text-align: center;
    min-width: 280px;
    position: relative;
    animation: pulse-glow 2s infinite;
  }

  @keyframes pulse-glow {
    0%, 100% { box-shadow: 0 10px 30px rgba(105, 190, 40, 0.6); }
    50% { box-shadow: 0 15px 40px rgba(105, 190, 40, 0.9); }
  }

  .prompt {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: #002244;
    padding: 6px 15px;
    border-radius: 15px;
    font-size: 14px;
    white-space: nowrap;
    font-weight: 600;
    border: 2px solid #69BE28;
    color: #69BE28;
  }

  .controls-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
    min-width: 320px;
  }

  .btn {
    background: linear-gradient(135deg, #69BE28 0%, #4A8A1F 100%);
    color: #002244;
    padding: 16px 35px;
    border: none;
    border-radius: 50px;
    font-size: 20px;
    font-weight: 800;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(105, 190, 40, 0.5);
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    border: 3px solid #002244;
    font-family: 'Montserrat', sans-serif;
  }

  .btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 35px rgba(105, 190, 40, 0.8);
    background: linear-gradient(135deg, #7ACF32 0%, #5A9A2F 100%);
  }

  .btn-cta {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #002244;
    font-size: 22px;
    padding: 18px 40px;
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
    border: 3px solid #002244;
  }

  .btn-cta:hover {
    box-shadow: 0 15px 40px rgba(255, 215, 0, 0.9);
    background: linear-gradient(135deg, #FFE55C 0%, #FFB347 100%);
  }

  .stats-panel {
    background: linear-gradient(135deg, rgba(0, 34, 68, 0.9) 0%, rgba(0, 51, 102, 0.9) 100%);
    padding: 25px;
    border-radius: 20px;
    text-align: center;
    border: 3px solid #69BE28;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
  }

  .stats-panel h3 {
    color: #69BE28;
    font-size: 24px;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 3px;
  }

  .stat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }

  .stat-item {
    background: rgba(0, 25, 51, 0.7);
    padding: 12px;
    border-radius: 12px;
    border: 2px solid #69BE28;
  }

  .stat-value {
    font-size: 28px;
    font-weight: 800;
    color: #69BE28;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 2px;
  }

  .stat-label {
    font-size: 14px;
    color: #A5ACAF;
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
  }

  .status {
    position: fixed;
    top: 15px;
    right: 15px;
    background: rgba(0, 34, 68, 0.9);
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    border: 2px solid #69BE28;
    color: #69BE28;
    z-index: 1000;
    font-weight: 600;
  }

  .bigwin {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    font-size: 7em;
    color: #FFD700;
    text-shadow: 0 0 40px #FFD700, 0 0 80px #FFA500;
    z-index: 9999;
    pointer-events: none;
    animation: win 2s forwards;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 6px;
  }

  @keyframes win {
    0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }

  .disc-counter {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(0, 34, 68, 0.9);
    padding: 10px 20px;
    border-radius: 20px;
    border: 2px solid #69BE28;
    color: #69BE28;
    font-weight: 800;
    font-size: 18px;
    z-index: 10;
  }

  @media (max-width: 768px) {
    .game-container {
      flex-direction: column;
      align-items: center;
    }
    
    .controls-section {
      width: 100%;
    }
    
    .title {
      font-size: 3em;
    }
    
    .subtitle {
      font-size: 1.1em;
    }
    
    .cta-text {
      font-size: 1.1em;
    }
  }
</style>
</head>
<body>

<div class="status" id="status">Connecting to cloud‚Ä¶</div>
<div class="header">
  <h1 class="title">U.S. LAWSHIELD PLINKO</h1>
  <p class="subtitle">LEGAL DEFENSE FOR SELF DEFENSE¬Æ</p>
  
  <div class="cta-banner">
    <div class="cta-text">üéØ EARN DISCS ‚Ä¢ WIN BIG ‚Ä¢ CLIMB THE LEADERBOARD üéØ</div>
  </div>
</div>

<div class="game-container">
  <div class="plinko-section">
    <div class="canvas-wrapper">
      <div class="disc-counter">Discs: <span id="discCounter">0</span></div>
      <canvas id="c" width="720" height="1080"></canvas>
    </div>
    <div class="drop-zone">
      DROP ZONE
      <div class="prompt">Grab disc ‚Üí Position ‚Üí Release to win!</div>
    </div>
  </div>
  
  <div class="controls-section">
    <button class="btn btn-cta" onclick="earnDisc()">üéÅ EARN FREE DISC</button>
    <button class="btn" onclick="showLeaderboard()">üèÜ VIEW LEADERBOARD</button>
    
    <div class="stats-panel">
      <h3>Your Performance</h3>
      <div class="stat-grid">
        <div class="stat-item">
          <div class="stat-value" id="total">0</div>
          <div class="stat-label">Total Winnings</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="best">0</div>
          <div class="stat-label">Best Drop</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="played">0</div>
          <div class="stat-label">Discs Played</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="avail">0</div>
          <div class="stat-label">Available Now</div>
        </div>
      </div>
    </div>

    <div class="cta-banner" style="margin: 0;">
      <div class="cta-text" style="font-size: 1.1em;">üöÄ EARN MORE ‚Üí PLAY MORE ‚Üí WIN MORE! üöÄ</div>
    </div>
  </div>
</div>

<script>
// ==================== JSONBIN.IO CLOUD ====================
const MASTER_KEY = "$2a$10$NckuWO.y9g8.amyZZWkc8.lKIMS.AVSCyN1qT9/0d5EtRjuV9lmS2";
const BIN_URL = "https://api.jsonbin.io/v3/b";
let BIN_ID = localStorage.getItem("plinko_bin_id") || null;
let cloud = {employees:{},activities:[],leaderboard:[]};

async function loadCloud(){
  try{
    if(!BIN_ID) throw "no bin";
    const r = await fetch(`${BIN_URL}/${BIN_ID}/latest`,{headers:{'X-Master-Key':MASTER_KEY}});
    const data = await r.json();
    cloud = data.record || cloud;
    document.getElementById("status").textContent="Cloud Connected";
  }catch(e){
    const r = await fetch(BIN_URL,{method:"POST",headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY,'X-Bin-Name':'USLawShield-Plinko'},body:JSON.stringify(cloud)});
    const j = await r.json();
    BIN_ID = j.metadata.id;
    localStorage.setItem("plinko_bin_id",BIN_ID);
    document.getElementById("status").textContent="Cloud Created";
  }
}

async function saveCloud(){
  if(!BIN_ID) return;
  await fetch(`${BIN_URL}/${BIN_ID}`,{method:"PUT",headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY},body:JSON.stringify(cloud)});
}

// ==================== EMPLOYEE & STATE ====================
let employeeId = localStorage.getItem("empId");
let name = localStorage.getItem("empName");
if(!name){ 
  name = prompt("üéÆ Welcome to U.S. LawShield Plinko!\n\nEnter your name to get started:") || "Player"; 
  localStorage.setItem("empName",name); 
}
if(!employeeId){ employeeId = "emp_"+Date.now(); localStorage.setItem("empId",employeeId); }
if(!cloud.employees[employeeId]) cloud.employees[employeeId] = {name,total:0,best:0,played:0,discs:0,used:0};
let p = cloud.employees[employeeId];

// ==================== PLINKO PHYSICS ====================
const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const DROP_H = 120, DISC_R = 30, PEG_R = 8;
const ROWS = 16, SLOTS = 9;
const VALUES = [100,500,1000,0,10000,0,1000,500,100];

// Modern, vibrant slot colors
const SLOT_COLORS = [
  'linear-gradient(45deg, #667eea 0%, #764ba2 100%)',   // Purple gradient
  'linear-gradient(45deg, #f093fb 0%, #f5576c 100%)',   // Pink gradient  
  'linear-gradient(45deg, #4facfe 0%, #00f2fe 100%)',   // Blue gradient
  'linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%)',   // Red gradient
  'linear-gradient(45deg, #f6d365 0%, #fda085 100%)',   // Gold gradient - JACKPOT
  'linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%)',   // Red gradient
  'linear-gradient(45deg, #4facfe 0%, #00f2fe 100%)',   // Blue gradient
  'linear-gradient(45deg, #f093fb 0%, #f5576c 100%)',   // Pink gradient
  'linear-gradient(45deg, #667eea 0%, #764ba2 100%)'    // Purple gradient
];

let pegs = [], disc = null, trail = [], particles = [], time = 0;
let hovering = {x:W/2, y:DROP_H/2, speed:1.5, amp: W/2 - DISC_R - 50};
let dragging = false;

function initPegs(){
  const startY = DROP_H + 90;
  const rowH = (H - 240 - startY) / ROWS;
  const colW = W / 10;
  for(let r=0;r<ROWS;r++){
    const cols = r%2===0?9:10;
    const offset = r%2===0?colW:colW/2;
    for(let c=0;c<cols;c++){
      pegs.push({x:offset+c*colW,y:startY+r*rowH});
    }
  }
}
initPegs();

function draw(){
  time += 0.016;
  
  // Board background
  ctx.fillStyle="#001933";
  ctx.fillRect(0,0,W,H);
  
  // Drop zone
  const grad = ctx.createLinearGradient(0,0,0,DROP_H);
  grad.addColorStop(0,"#69BE28");
  grad.addColorStop(1,"#4A8A1F");
  ctx.fillStyle=grad;
  ctx.fillRect(0,0,W,DROP_H);
  
  ctx.strokeStyle="#002244";
  ctx.lineWidth=6;
  ctx.strokeRect(0,0,W,DROP_H);
  
  ctx.fillStyle="#002244";
  ctx.font="bold 32px Montserrat";
  ctx.textAlign="center";
  ctx.fillText("DROP ZONE",W/2,DROP_H/2+12);
  
  // Pegs
  pegs.forEach(p=>{
    const g = ctx.createRadialGradient(p.x-4,p.y-4,0,p.x,p.y,PEG_R);
    g.addColorStop(0,"#69BE28");
    g.addColorStop(1,"#4A8A1F");
    ctx.fillStyle=g;
    ctx.beginPath();
    ctx.arc(p.x,p.y,PEG_R,0,Math.PI*2);
    ctx.fill();
    
    ctx.shadowColor = "#69BE28";
    ctx.shadowBlur = 8;
    ctx.fill();
    ctx.shadowBlur = 0;
  });
  
  // Modern slots with rotated text
  const sh=130, sw=W/SLOTS;
  VALUES.forEach((v,i)=>{
    // Create gradient fill for slot
    const slotGradient = ctx.createLinearGradient(i*sw, H-sh, i*sw, H);
    if(i === 4) { // Jackpot slot
      slotGradient.addColorStop(0, "#f6d365");
      slotGradient.addColorStop(1, "#fda085");
    } else if(v === 0) { // Zero slots
      slotGradient.addColorStop(0, "#ff6b6b");
      slotGradient.addColorStop(1, "#ee5a52");
    } else { // Value slots
      const colors = [
        ['#667eea', '#764ba2'],
        ['#f093fb', '#f5576c'],
        ['#4facfe', '#00f2fe']
      ];
      const colorIndex = [0,1,2,0,0,0,2,1,0][i];
      slotGradient.addColorStop(0, colors[colorIndex][0]);
      slotGradient.addColorStop(1, colors[colorIndex][1]);
    }
    
    ctx.fillStyle = slotGradient;
    ctx.fillRect(i*sw, H-sh, sw, sh);
    
    // Slot borders
    ctx.strokeStyle="#69BE28";
    ctx.lineWidth=4;
    ctx.strokeRect(i*sw, H-sh, sw, sh);
    
    // Rotated text (vertical)
    ctx.save();
    ctx.translate(i*sw + sw/2, H - sh/2);
    ctx.rotate(-Math.PI/2); // Rotate 90 degrees counter-clockwise
    
    ctx.fillStyle="white";
    ctx.font="bold 20px Montserrat";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    
    // Add dollar sign and format numbers
    const displayText = v === 0 ? "0" : "$" + v.toLocaleString();
    ctx.fillText(displayText, 0, 0);
    
    ctx.restore();
  });
  
  // Hovering disc
  const avail = p.discs - p.used;
  if(avail > 0 && !disc && !dragging){
    hovering.x = W/2 + Math.sin(time * hovering.speed) * hovering.amp;
    drawDisc(hovering.x, hovering.y, Math.sin(time*2)*0.15);
  }
  
  // Trail
  trail.forEach((t,i)=>{
    ctx.globalAlpha=i/trail.length*0.5;
    ctx.fillStyle="#69BE28";
    ctx.beginPath();
    ctx.arc(t.x,t.y,DISC_R*0.8,0,Math.PI*2);
    ctx.fill();
  });
  ctx.globalAlpha=1;
  
  // Active disc
  if(disc){
    drawDisc(disc.x, disc.y, disc.spin);
  }
  
  // Particles
  particles = particles.filter(pa=>{
    pa.y -= pa.vy;
    pa.life--;
    ctx.globalAlpha = pa.life/50;
    ctx.fillStyle=pa.color;
    ctx.beginPath();
    ctx.arc(pa.x+Math.sin(pa.life)*25,pa.y,10,0,Math.PI*2);
    ctx.fill();
    return pa.life>0;
  });
  ctx.globalAlpha=1;
}

function drawDisc(x,y,spin=0){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(spin);
  
  const g = ctx.createRadialGradient(-9,-9,0,0,0,DISC_R);
  g.addColorStop(0,"#69BE28");
  g.addColorStop(0.7,"#4A8A1F");
  g.addColorStop(1,"#002244");
  ctx.fillStyle=g;
  ctx.beginPath();
  ctx.arc(0,0,DISC_R,0,Math.PI*2);
  ctx.fill();
  
  ctx.strokeStyle="#002244";
  ctx.lineWidth=3;
  ctx.stroke();
  
  ctx.fillStyle="#002244";
  ctx.beginPath();
  ctx.arc(-9,-9,DISC_R*0.4,0,Math.PI*2);
  ctx.fill();
  
  ctx.fillStyle="white";
  ctx.font="bold 16px Montserrat";
  ctx.textAlign="center";
  ctx.fillText("USL",0,5);
  
  ctx.restore();
}

// Update disc counter
function updateDiscCounter() {
  document.getElementById("discCounter").textContent = p.discs - p.used;
  document.getElementById("avail").textContent = p.discs - p.used;
}

// Hover + drag logic
canvas.addEventListener("mousemove",(e)=>{
  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left, my = e.clientY - r.top;
  const avail = p.discs - p.used;
  const hx = hovering.x, hy = hovering.y;
  const nearHover = avail > 0 && !disc && !dragging && Math.hypot(mx-hx,my-hy) < DISC_R*1.3;
  
  if(nearHover) canvas.style.cursor = "grab";
  else if(dragging) canvas.style.cursor = "grabbing";
  else canvas.style.cursor = "default";
  
  if(dragging && disc){
    disc.x = Math.max(DISC_R+30, Math.min(W-DISC_R-30, mx));
    disc.y = Math.max(30, Math.min(DROP_H-30, my));
    draw();
  }
});

canvas.addEventListener("mousedown",(e)=>{
  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left, my = e.clientY - r.top;
  const avail = p.discs - p.used;
  
  if(avail > 0 && !disc && Math.hypot(mx-hovering.x,my-hovering.y) < DISC_R*1.3){
    dragging = true;
    canvas.style.cursor = "grabbing";
    disc = {x:mx, y:my, vx:0, vy:0, spin:0, spinV:0};
    draw();
  }
});

canvas.addEventListener("mouseup",(e)=>{
  if(!dragging) return;
  dragging = false;
  canvas.style.cursor = "default";
  
  if(disc && disc.y <= DROP_H){
    disc.vx = (Math.random()-0.5)*80;
    disc.vy = 0;
    disc.spinV = (Math.random()-0.5)*0.8;
    trail = [];
    p.used++;
    updateDiscCounter();
    saveCloud();
    requestAnimationFrame(physics);
  }else{
    disc = null;
  }
  draw();
});

canvas.addEventListener("mouseleave",()=>{
  if(dragging){
    dragging=false;
    disc=null;
    draw();
  }
});

// Physics loop
function physics(){
  if(!disc) return;
  
  disc.vy += 520;
  disc.vx *= 0.993;
  disc.vy *= 0.993;
  disc.x += disc.vx * 0.016;
  disc.y += disc.vy * 0.016;
  disc.spin += disc.spinV;
  disc.spinV *= 0.99;
  
  trail.push({x:disc.x,y:disc.y});
  if(trail.length>40) trail.shift();
  
  pegs.forEach(p=>{
    const dx=disc.x-p.x, dy=disc.y-p.y, d=Math.hypot(dx,dy);
    if(d < DISC_R+PEG_R){
      const nx=dx/d, ny=dy/d;
      const dot = disc.vx*nx + disc.vy*ny;
      disc.vx -= 2.1*dot*nx*0.78;
      disc.vy -= 2.1*dot*ny*0.78;
      disc.spinV += (Math.random()-0.5)*0.7;
      disc.vx += (Math.random()-0.5)*45;
      
      const overlap = DISC_R+PEG_R-d;
      disc.x += nx*overlap*1.2;
      disc.y += ny*overlap*1.2;
    }
  });
  
  if(disc.x < DISC_R+30){
    disc.x = DISC_R+30;
    disc.vx = Math.abs(disc.vx)*0.8;
  }
  if(disc.x > W-DISC_R-30){
    disc.x = W-DISC-R-30;
    disc.vx = -Math.abs(disc.vx)*0.8;
  }
  
  if(disc.y > H-150){
    const slot = Math.floor(disc.x / (W/SLOTS));
    const win = VALUES[Math.min(Math.max(slot,0),8)];
    p.total += win;
    p.best = Math.max(p.best,win);
    p.played++;
    
    document.getElementById("total").textContent = p.total.toLocaleString();
    document.getElementById("best").textContent = p.best.toLocaleString();
    document.getElementById("played").textContent = p.played;
    
    // Update leaderboard
    updateLeaderboard();
    
    if(win >= 1000){
      const el = document.createElement("div");
      el.className="bigwin";
      el.textContent = "$"+win.toLocaleString()+"!";
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),3000);
      
      for(let i=0;i<100;i++) particles.push({
        x:disc.x,
        y:H-120,
        vy:Math.random()*14+8,
        life:60,
        color: win === 10000 ? "#FFD700" : "#69BE28"
      });
    }
    saveCloud();
    disc = null;
    trail = [];
  }
  
  draw();
  if(disc) requestAnimationFrame(physics);
}

// Update leaderboard
function updateLeaderboard() {
  if(!cloud.leaderboard) cloud.leaderboard = [];
  
  // Find if employee already in leaderboard
  const existingIndex = cloud.leaderboard.findIndex(entry => entry.id === employeeId);
  
  if(existingIndex !== -1) {
    cloud.leaderboard[existingIndex].total = p.total;
  } else {
    cloud.leaderboard.push({
      id: employeeId,
      name: name,
      total: p.total
    });
  }
  
  // Sort by total winnings
  cloud.leaderboard.sort((a, b) => b.total - a.total);
  
  // Keep only top 10
  cloud.leaderboard = cloud.leaderboard.slice(0, 10);
}

// Show leaderboard
function showLeaderboard() {
  const leaderboard = cloud.leaderboard || [];
  let leaderboardHTML = `
    <div style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); 
                background:linear-gradient(135deg, #002244, #003366); 
                padding:30px; border-radius:20px; border:4px solid #69BE28;
                color:white; z-index:10000; max-width:500px; width:90%;
                box-shadow:0 0 50px rgba(0,0,0,0.8); font-family:Montserrat;">
      <h2 style="text-align:center; color:#69BE28; margin-bottom:20px; font-family:'Bebas Neue';">üèÜ LEADERBOARD</h2>
      <div style="max-height:400px; overflow-y:auto;">
  `;
  
  if(leaderboard.length === 0) {
    leaderboardHTML += `<p style="text-align:center; color:#A5ACAF;">No scores yet! Be the first to play!</p>`;
  } else {
    leaderboard.forEach((player, index) => {
      const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index+1}.`;
      leaderboardHTML += `
        <div style="display:flex; justify-content:space-between; padding:12px; 
                    background:${index % 2 === 0 ? 'rgba(0,25,51,0.7)' : 'transparent'}; 
                    border-radius:8px; margin:5px 0;">
          <span>${medal} ${player.name}</span>
          <span style="color:#69BE28; font-weight:bold;">$${player.total.toLocaleString()}</span>
        </div>
      `;
    });
  }
  
  leaderboardHTML += `
      </div>
      <button onclick="this.parentElement.remove()" 
              style="margin-top:20px; padding:12px 30px; width:100%; 
                     background:#69BE28; color:#002244; border:none; 
                     border-radius:10px; font-weight:bold; cursor:pointer;">
        CLOSE
      </button>
    </div>
  `;
  
  const modal = document.createElement('div');
  modal.innerHTML = leaderboardHTML;
  document.body.appendChild(modal);
}

// Earn disc with better CTA
function earnDisc(){
  const activities = [
    "Single PR", "Dual PR", "Monthly LOC", "Annual LOC", 
    "Save", "Winback", "Add E-Shield", "Conversion"
  ];
  
  const activity = prompt(
    "üéØ EARN A FREE PLINKO DISC!\n\n" +
    "Select an activity you completed:\n\n" +
    activities.map((a, i) => `${i+1}. ${a}`).join("\n") +
    "\n\nEnter the number or name of the activity:"
  );
  
  if(!activity) return;
  
  const mid = prompt("Enter Member ID (e.g. TX123456):")?.toUpperCase();
  
  if(mid && /^[A-Z]{2,3}\d+$/.test(mid)){
    p.discs++;
    cloud.activities.push({
      employeeId,
      name,
      activity: activity,
      memberId: mid,
      time: Date.now()
    });
    
    updateDiscCounter();
    saveCloud();
    
    // Success message with encouragement
    alert("üéâ SUCCESS! Disc earned!\n\nHover over the green disc, grab it, and drop it in the DROP ZONE to win!\n\nGood luck! üçÄ");
    draw();
  } else {
    alert("‚ùå Please enter a valid Member ID (2-3 letters followed by numbers)");
  }
}

// Initialize the game
loadCloud().then(()=>{
  p.discs = p.discs||0;
  p.used = p.used||0;
  document.getElementById("total").textContent = p.total.toLocaleString();
  document.getElementById("best").textContent = p.best.toLocaleString();
  document.getElementById("played").textContent = p.played;
  updateDiscCounter();
  
  requestAnimationFrame(()=>{
    draw();
    requestAnimationFrame(()=>{
      draw();
    });
  });
});
</script>
</body>
</html>
